var WPFM_AjaxFileUpload=function(){return{init:function(){WPFM_Common.logInfo("WPFM_AjaxFileUpload.init..."),jQuery(".wp-food-manager-file-upload").each(function(){jQuery(this).fileupload({dataType:"json",dropZone:jQuery(this),url:wpfm_ajax_file_upload.ajax_url.toString().replace("%%endpoint%%","upload_file"),maxNumberOfFiles:1,formData:{script:!0},add:function(e,i){var t=jQuery(this),a=t.closest("form"),n=t.parent().find(".food-manager-uploaded-files"),o=[],l=jQuery(this).data("file_types");if(l){var r=RegExp("(.|/)("+l+")$","i");i.originalFiles[0].name.length&&!r.test(i.originalFiles[0].name)&&o.push(wpfm_ajax_file_upload.i18n_invalid_file_type)}o.length>0?alert(o.join("\n")):(a.find(':input[type="submit"]').attr("disabled","disabled"),i.context=jQuery('<progress value="" max="100"></progress>').appendTo(n),i.submit())},progress:function(e,i){jQuery(this).parent().find(".food-manager-uploaded-files");var t=parseInt(i.loaded/i.total*100,10);i.context.val(t)},fail:function(e,i){jQuery(this).closest("form").find(':input[type="submit"]').removeAttr("disabled")},done:function(e,i){var t=jQuery(this),a=t.closest("form"),n=t.parent().find(".food-manager-uploaded-files"),o=t.attr("multiple")?1:0,l=["jpg","gif","png","jpeg","jpe"];i.context.remove(),jQuery.each(i.result.files,function(e,i){if(i.error)alert(i.error);else{if(jQuery.inArray(i.extension,l)>=0){var a=jQuery.parseHTML(wpfm_ajax_file_upload.js_field_html_img);jQuery(a).find(".food-manager-uploaded-file-preview img").attr("src",i.url)}else{var a=jQuery.parseHTML(wpfm_ajax_file_upload.js_field_html);jQuery(a).find(".food-manager-uploaded-file-name code").text(i.name)}jQuery(a).find(".input-text").val(i.url),jQuery(a).find(".input-text").attr("name","current_"+t.attr("name")),o?n.append(a):n.html(a)}}),a.find(':input[type="submit"]').removeAttr("disabled")}})})}}};WPFM_AjaxFileUpload=WPFM_AjaxFileUpload(),jQuery(document).ready(function(e){WPFM_AjaxFileUpload.init()});