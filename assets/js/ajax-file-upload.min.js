var WPFMAjaxFileUpload=function(){return{init:function(){WPFMCommon.logInfo("WPFMAjaxFileUpload.init..."),jQuery(".wp-food-manager-file-upload").each((function(){jQuery(this).fileupload({dataType:"json",dropZone:jQuery(this),url:wpfm_ajax_file_upload.ajax_url.toString().replace("%%endpoint%%","upload_file"),maxNumberOfFiles:1,formData:{script:!0},add:function(e,data){var =jQuery(this),=.closest("form"),=.parent().find(".food-manager-uploaded-files"),uploadErrors=[],allowed_types=jQuery(this).data("file_types");if(allowed_types){var acceptFileTypes=new RegExp("(.|/)("+allowed_types+")$","i");data.originalFiles[0].name.length&&!acceptFileTypes.test(data.originalFiles[0].name)&&uploadErrors.push(wpfm_ajax_file_upload.i18n_invalid_file_type+" "+allowed_types)}uploadErrors.length>0?alert(uploadErrors.join("\n")):(.find(':input[type="submit"]').attr("disabled","disabled"),data.context=jQuery('<progress value="" max="100"></progress>').appendTo(),data.submit())},progress:function(e,data){var ,=jQuery(this).parent().find(".food-manager-uploaded-files"),progress=parseInt(data.loaded/data.total*100,10);data.context.val(progress)},fail:function(e,data){var ,;jQuery(this).closest("form").find(':input[type="submit"]').removeAttr("disabled")},done:function(e,data){var =jQuery(this),=.closest("form"),=.parent().find(".food-manager-uploaded-files"),multiple=.attr("multiple")?1:0,image_types=["jpg","gif","png","jpeg","jpe"];data.context.remove(),jQuery.each(data.result.files,(function(index,file){if(file.error)alert(file.error);else{if(jQuery.inArray(file.extension,image_types)>=0){var html=jQuery.parseHTML(wpfm_ajax_file_upload.js_field_html_img);jQuery(html).find(".food-manager-uploaded-file-preview img").attr("src",file.url)}else{var html=jQuery.parseHTML(wpfm_ajax_file_upload.js_field_html);jQuery(html).find(".food-manager-uploaded-file-name code").text(file.name)}jQuery(html).find(".input-text").val(file.url),jQuery(html).find(".input-text").attr("name","current_"+.attr("name")),multiple?.append(html):.html(html)}})),.find(':input[type="submit"]').removeAttr("disabled")}})}))}}};WPFMAjaxFileUpload=WPFMAjaxFileUpload(),jQuery(document).ready((function($){WPFMAjaxFileUpload.init()}));