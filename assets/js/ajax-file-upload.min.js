var AjaxFileUpload=function(){return{init:function(){Common.logInfo("AjaxFileUpload.init..."),jQuery(".wp-food-manager-file-upload").each((function(){jQuery(this).fileupload({dataType:"json",dropZone:jQuery(this),url:wpfm_ajax_file_upload.ajax_url.toString().replace("%%endpoint%%","upload_file"),maxNumberOfFiles:1,formData:{script:!0},add:function(e,a){var i=jQuery(this),t=i.closest("form"),r=i.parent().find(".food-manager-uploaded-files"),n=[],l=jQuery(this).data("file_types");if(l){var o=new RegExp("(.|/)("+l+")$","i");a.originalFiles[0].name.length&&!o.test(a.originalFiles[0].name)&&n.push(wpfm_ajax_file_upload.i18n_invalid_file_type+" "+l)}n.length>0?alert(n.join("\n")):(t.find(':input[type="submit"]').attr("disabled","disabled"),a.context=jQuery('<progress value="" max="100"></progress>').appendTo(r),a.submit())},progress:function(e,a){jQuery(this).parent().find(".food-manager-uploaded-files");var i=parseInt(a.loaded/a.total*100,10);a.context.val(i)},fail:function(e,a){jQuery(this).closest("form").find(':input[type="submit"]').removeAttr("disabled")},done:function(e,a){var i=jQuery(this),t=i.closest("form"),r=i.parent().find(".food-manager-uploaded-files"),n=i.attr("multiple")?1:0,l=["jpg","gif","png","jpeg","jpe"];a.context.remove(),jQuery.each(a.result.files,(function(e,a){if(a.error)alert(a.error);else{if(jQuery.inArray(a.extension,l)>=0){var t=jQuery.parseHTML(wpfm_ajax_file_upload.js_field_html_img);jQuery(t).find(".food-manager-uploaded-file-preview img").attr("src",a.url)}else{t=jQuery.parseHTML(wpfm_ajax_file_upload.js_field_html);jQuery(t).find(".food-manager-uploaded-file-name code").text(a.name)}jQuery(t).find(".input-text").val(a.url),jQuery(t).find(".input-text").attr("name","current_"+i.attr("name")),n?r.append(t):r.html(t),r.children().removeClass("empty-src")}})),t.find(':input[type="submit"]').removeAttr("disabled")}})}))}}};AjaxFileUpload=AjaxFileUpload(),jQuery(document).ready((function(e){AjaxFileUpload.init(),jQuery("#wpfm-add-new-option").click((function(){AjaxFileUpload.init()}))}));