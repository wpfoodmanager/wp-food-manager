var MultiAppearanceselect = function () {
    return {
        init: function () {
            WPFM_Common.logInfo("MultiAppearanceselect.init...");

            jQuery('.multiselect_appearance .food-manager-category-dropdown').on('change', function () {

                // defining variables
                var data_name = jQuery(this).parents('.wpfm-form-group').find('.selection-preview').attr('data-name'),
                preview_htm = '',
                unit_options = '<option value="">Unit</option>',
                selected_terms = {},
                units = JSON.parse(appearance_params.unit_terms);

                // Push selected value array
                jQuery.each(jQuery(this).find('option'), function (key, value) {
                    if( jQuery(this).is(':selected') ){

                        // Define term id and term name
                        var term_id = jQuery(this).val(),
                        label = jQuery(this).text();

                        // array
                        selected_terms[term_id] = label;

                    }
                });
                
                // units html
                jQuery.each(units, function (key, unit) {
                    unit_options += '<option value="'+unit.term_id+'">'+unit.name+'</option>';
                });

                // preview html
                jQuery.each(selected_terms, function (term_id, label) {
                    term_id = parseInt(term_id);
                    preview_htm += '<li class="term-item" data-id="' + term_id + '">';
                    preview_htm += '<label>' + label + '</label>';
                    preview_htm += '<input type="number" name="' + data_name + '[' + term_id + '][value]">';
                    preview_htm += '<select name="' + data_name + '[' + term_id + '][unit_id]">'+unit_options+'</select>';
                    preview_htm += '</li>';
                });
                
                // Append preview html
                jQuery(this).parents('.wpfm-form-group').find('.selection-preview ul').html(preview_htm);
            });
            
        }
    }
};

MultiAppearanceselect = MultiAppearanceselect();
jQuery(document).ready(function ($) {
    MultiAppearanceselect.init();
});