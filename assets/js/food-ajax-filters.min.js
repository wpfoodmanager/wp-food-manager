var WPFMFoodAjaxFilters=function(){var e,o=[];return{init:function(){WPFMCommon.logInfo("WPFMFoodAjaxFilters.init..."),jQuery.isFunction(jQuery.fn.chosen)&&(1==food_manager_ajax_filters.is_rtl&&(jQuery('select[name^="search_datetimes"]').addClass("chosen-rtl"),jQuery('select[name^="search_categories"]').addClass("chosen-rtl"),jQuery('select[name^="search_food_types"]').addClass("chosen-rtl"),jQuery('select[name^="search_ticket_prices"]').addClass("chosen-rtl")),jQuery('select[name^="search_datetimes"]').chosen({search_contains:!0}),jQuery('select[name^="search_categories"]').chosen({search_contains:!0}),jQuery('select[name^="search_food_types"]').chosen({search_contains:!0}),jQuery('select[name^="search_ticket_prices"]').chosen({search_contains:!0})),e=!(!window.history||!window.history.pushState),jQuery(window).on("load",WPFMFoodAjaxFilters.actions.windowLoad),jQuery(document.body).on("click",".load_more_foods",WPFMFoodAjaxFilters.actions.loadMorefoods),jQuery(".food_filters").on("click",".reset",WPFMFoodAjaxFilters.actions.WPFMFoodAjaxFiltersReset),jQuery("div.food_listings").on("click",".food-manager-pagination a",WPFMFoodAjaxFilters.actions.foodPagination),jQuery(".food_listings").on("update_food_listings",WPFMFoodAjaxFilters.actions.getfoodListings),jQuery("#search_keywords, #search_location, #search_datetimes, #search_categories, #search_food_types, #search_ticket_prices, .food-manager-filter").change(function(){var e=jQuery(this).closest("div.food_listings");e.triggerHandler("update_food_listings",[1,!1]),WPFMFoodAjaxFilters.food_manager_store_state(e,1)}).on("keyup",function(e){13===e.which&&jQuery(this).trigger("change")})},food_manager_store_state:function(o,a){WPFMCommon.logInfo("WPFMFoodAjaxFilters.food_manager_store_state...");var t=document.location.href.split("#")[0];if(e){var i=o.find(".food_filters"),r=jQuery(i).serialize(),s=jQuery("div.food_listings").index(o);window.history.replaceState({id:"food_manager_state",page:a,data:r,index:s},"",t+"#foods")}},actions:{windowLoad:function(e){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.windowLoad..."),jQuery(".food_filters").each(function(){var e=jQuery(this).closest("div.food_listings"),o=e.find(".food_filters"),a=1,t=jQuery("div.food_listings").index(e);if(window.history.state&&window.location.hash){var i=window.history.state;console.log(o.deserialize(i.data)),i.id&&"food_manager_state"===i.id&&t==i.index&&(a=1,o.deserialize(i.data),o.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').trigger("chosen:updated"),o.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"),o.find(':input[name^="search_food_types"]').not(':input[type="hidden"]').trigger("chosen:updated"),o.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').trigger("chosen:updated"))}e.triggerHandler("update_food_listings",[a,!1])}),e.preventDefault ()},WPFMFoodAjaxFiltersReset:function(e){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.WPFMFoodAjaxFiltersReset...");var o=jQuery(this).closest("div.food_listings"),a=jQuery(this).closest("form");return a.find(':input[name="search_keywords"], :input[name="search_location"], .food-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),a.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_food_types"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),a.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),o.triggerHandler("reset"),o.triggerHandler("update_food_listings",[1,!1]),WPFMFoodAjaxFilters.food_manager_store_state(o,1),!1},loadMorefoods:function(e){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.loadMorefoods...");var o=jQuery(this).closest("div.food_listings"),a=parseInt(jQuery(this).data("page")||1);return jQuery(this).addClass("wpfm-loading"),a+=1,jQuery(this).data("page",a),WPFMFoodAjaxFilters.food_manager_store_state(o,a),o.triggerHandler("update_food_listings",[a,!0,!1]),!1},foodPagination:function(e){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.foodPagination...");var o=jQuery(this).closest("div.food_listings"),a=jQuery(this).data("page");return WPFMFoodAjaxFilters.food_manager_store_state(o,a),o.triggerHandler("update_food_listings",[a,!1]),jQuery("body, html").animate({scrollTop:o.offset().top},600),!1},getfoodListings:function(e,a,t,i){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.getfoodListings...");var r="",s=jQuery(this),n=s.find(".food_filters"),d=s.find(".showing_applied_filters"),l=s.find(".food_listings"),c=s.data("per_page"),_=s.data("orderby"),g=s.data("order"),f=s.data("featured"),u=s.data("cancelled"),p=jQuery("div.food_listings").index(this);if(!(p<0)){if(o[p]&&o[p].abort(),t||(jQuery(l).addClass("wpfm-loading"),jQuery("div.food_listing, div.no_food_listings_found",l).css("visibility","hidden"),s.find(".load_more_foods").data("page",a)),1==s.data("show_filters")){var h=n.find(':input[name^="search_datetimes"]').map(function(){return jQuery(this).val()}).get(),m=n.find(':input[name^="search_categories"]').map(function(){return jQuery(this).val()}).get(),y=n.find(':input[name^="search_food_types"]').map(function(){return jQuery(this).val()}).get(),j=n.find(':input[name^="search_ticket_prices"]').map(function(){return jQuery(this).val()}).get(),Q="",v="",w=n.find(':input[name="search_keywords"]'),F=n.find(':input[name="search_location"]');w.val()!==w.attr("placeholder")&&(Q=w.val()),F.val()!==F.attr("placeholder")&&(v=F.val()),r={lang:food_manager_ajax_filters.lang,search_keywords:Q,search_location:v,search_datetimes:h,search_categories:m,search_food_types:y,search_ticket_prices:j,per_page:c,orderby:_,order:g,page:a,featured:f,cancelled:u,show_pagination:s.data("show_pagination"),form_data:n.serialize()}}else{Q=s.data("keywords"),v=s.data("location"),h=s.data("datetimes"),m=s.data("categories"),y=s.data("food_types"),j=s.data("ticket_prices");m&&(m=m.split(",")),r={lang:food_manager_ajax_filters.lang,search_keywords:Q,search_location:v,search_datetimes:h,search_categories:m,search_food_types:y,search_ticket_prices:j,per_page:c,orderby:_,order:g,page:a,featured:f,cancelled:u,show_pagination:s.data("show_pagination")}}o[p]=jQuery.ajax({type:"POST",url:food_manager_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:r,success:function(e){if(e)try{e.filter_value?jQuery(d).show().html("<span>"+e.filter_value+"</span>"+e.showing_links):jQuery(d).hide(),e.showing_applied_filters?jQuery(d).addClass("showing-applied-filters"):jQuery(d).removeClass("showing-applied-filters"),e.html&&(t&&i?(jQuery(l).prepend(e.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):t?(jQuery(l).append(e.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):jQuery(l).html(e.html)),1==s.data("show_pagination")?(s.find(".food-manager-pagination").remove(),e.pagination&&s.append(e.pagination)):(!e.found_foods||e.max_num_pages<=a?jQuery(".load_more_foods:not(.load_previous)",s).hide():i||jQuery(".load_more_foods",s).show(),jQuery(".load_more_foods",s).removeClass("wpfm-loading"),jQuery("li.food_listing",l).css("visibility","visible")),jQuery(l).removeClass("wpfm-loading"),s.triggerHandler("updated_results",e)}catch(e){window.console&&WPFMCommon.logError(e)}},error:function(e,o,a){window.console&&"abort"!==o&&WPFMCommon.logError(o+": "+a)},statusCode:{404:function(){window.console&&WPFMCommon.logError("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}}),e.preventDefault ()}}}}};WPFMFoodAjaxFilters=WPFMFoodAjaxFilters(),jQuery(document).ready(function(e){WPFMFoodAjaxFilters.init()});