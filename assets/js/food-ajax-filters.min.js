var WPFMFoodAjaxFilters=function(){var supportHtml5History,xmlHttpRequest=[];return{init:function(){WPFMCommon.logInfo("WPFMFoodAjaxFilters.init..."),jQuery.isFunction(jQuery.fn.chosen)&&(1==wpfm_ajax_filters.is_rtl&&(jQuery('select[name^="search_datetimes"]').addClass("chosen-rtl"),jQuery('select[name^="search_categories"]').addClass("chosen-rtl"),jQuery('select[name^="search_food_types"]').addClass("chosen-rtl"),jQuery('select[name^="search_ticket_prices"]').addClass("chosen-rtl")),jQuery('select[name^="search_datetimes"]').chosen({search_contains:!0}),jQuery('select[name^="search_categories"]').chosen({search_contains:!0}),jQuery('select[name^="search_food_types"]').chosen({search_contains:!0}),jQuery('select[name^="search_ticket_prices"]').chosen({search_contains:!0})),supportHtml5History=!(!window.history||!window.history.pushState),jQuery(document).ready(WPFMFoodAjaxFilters.actions.windowLoad),jQuery(document.body).on("click",".load_more_foods",WPFMFoodAjaxFilters.actions.loadMorefoods),jQuery(".food_filters").on("click",".reset",WPFMFoodAjaxFilters.actions.WPFMFoodAjaxFiltersReset),jQuery("div.food_listings").on("click",".food-manager-pagination a",WPFMFoodAjaxFilters.actions.foodPagination),jQuery(".food_listings").on("update_food_listings",WPFMFoodAjaxFilters.actions.getfoodListings),jQuery("#search_keywords, #search_location, #search_datetimes, #search_categories, #search_food_types, #search_ticket_prices, .food-manager-filter").change((function(){var target=jQuery(this).closest("div.food_listings");target.triggerHandler("update_food_listings",[1,!1]),WPFMFoodAjaxFilters.food_manager_store_state(target,1)})).on("keyup",(function(e){13===e.which&&jQuery(this).trigger("change")}))},food_manager_store_state:function(target,page){WPFMCommon.logInfo("WPFMFoodAjaxFilters.food_manager_store_state...");var location=document.location.href.split("#")[0];if(supportHtml5History){var form=target.find(".food_filters"),data=jQuery(form).serialize(),index=jQuery("div.food_listings").index(target);window.history.replaceState({id:"food_manager_state",page:page,data:data,index:index},"",location)}},actions:{windowLoad:function(event){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.windowLoad..."),jQuery(".food_filters").each((function(){var target=jQuery(this).closest("div.food_listings");console.log(jQuery(this).closest("div.food_listings").length);var form=target.find(".food_filters"),inital_page=1,index=jQuery("div.food_listings").index(target);if(window.history.state&&window.location.hash){var state=window.history.state;console.log(form.deserialize(state.data)),state.id&&"food_manager_state"===state.id&&index==state.index&&(inital_page=1,form.deserialize(state.data),form.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').trigger("chosen:updated"),form.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"),form.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').trigger("chosen:updated"),form.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').trigger("chosen:updated"))}target.triggerHandler("update_food_listings",[inital_page,!1])}))},WPFMFoodAjaxFiltersReset:function(event){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.WPFMFoodAjaxFiltersReset...");var target=jQuery(this).closest("div.food_listings"),form=jQuery(this).closest("form");return form.find(':input[name="search_keywords"], :input[name="search_location"], .food-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),form.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),form.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),form.find(':input[name^="search_food_types"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),form.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),target.triggerHandler("reset"),target.triggerHandler("update_food_listings",[1,!1]),WPFMFoodAjaxFilters.food_manager_store_state(target,1),!1},loadMorefoods:function(event){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.loadMorefoods...");var target=jQuery(this).closest("div.food_listings"),page=parseInt(jQuery(this).data("page")||1),loading_previous=!1;return jQuery(this).addClass("wpfm-loading"),page+=1,jQuery(this).data("page",page),target.triggerHandler("update_food_listings",[page,!0,!1]),!1},foodPagination:function(event){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.foodPagination...");var target=jQuery(this).closest("div.food_listings"),page=jQuery(this).data("page");return WPFMFoodAjaxFilters.food_manager_store_state(target,page),target.triggerHandler("update_food_listings",[page,!1]),jQuery("body, html").animate({scrollTop:target.offset().top},600),!1},getfoodListings:function(event,page,append,loading_previous){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.getfoodListings...");var data="",target=jQuery(this),form=target.find(".food_filters"),filters_bar=target.find(".showing_applied_filters"),results=target.find(".food_listings"),per_page=target.data("per_page"),orderby=target.data("orderby"),order=target.data("order"),featured=target.data("featured"),cancelled=target.data("cancelled"),index=jQuery("div.food_listings").index(this);if(!(index<0)){if(xmlHttpRequest[index]&&xmlHttpRequest[index].abort(),append||(jQuery(results).addClass("wpfm-loading"),jQuery("div.food_listing, div.no_food_listings_found",results).css("visibility","hidden"),target.find(".load_more_foods").data("page",page)),1==target.data("show_filters")){var filter_food_type=[],datetimes=form.find(':input[name^="search_datetimes"]').map((function(){return jQuery(this).val()})).get(),categories=form.find(':input[name^="search_categories"]').map((function(){return jQuery(this).val()})).get(),food_types=form.find(':input[name^="search_food_types"]').map((function(){return jQuery(this).val()})).get(),ticket_prices=form.find(':input[name^="search_ticket_prices"]').map((function(){return jQuery(this).val()})).get(),keywords="",location="",=form.find(':input[name="search_keywords"]'),=form.find(':input[name="search_location"]');.val()!==.attr("placeholder")&&(keywords=.val()),.val()!==.attr("placeholder")&&(location=.val()),data={lang:wpfm_ajax_filters.lang,search_keywords:keywords,search_location:location,search_datetimes:datetimes,search_categories:categories,search_food_types:food_types,search_ticket_prices:ticket_prices,per_page:per_page,orderby:orderby,order:order,page:page,featured:featured,cancelled:cancelled,show_pagination:target.data("show_pagination"),form_data:form.serialize()}}else{var keywords=target.data("keywords"),location=target.data("location"),datetimes=target.data("datetimes"),categories=target.data("categories"),food_types=target.data("food_types"),ticket_prices=target.data("ticket_prices");categories&&(categories=categories.split(",")),data={lang:wpfm_ajax_filters.lang,search_keywords:keywords,search_location:location,search_datetimes:datetimes,search_categories:categories,search_food_types:food_types,search_ticket_prices:ticket_prices,per_page:per_page,orderby:orderby,order:order,page:page,featured:featured,cancelled:cancelled,show_pagination:target.data("show_pagination")}}xmlHttpRequest[index]=jQuery.ajax({type:"POST",url:wpfm_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:data,success:function(result){if(result)try{result.filter_value?jQuery(filters_bar).show().html("<span>"+result.filter_value+"</span>"+result.showing_links):jQuery(filters_bar).hide(),result.showing_applied_filters?jQuery(filters_bar).addClass("showing-applied-filters"):jQuery(filters_bar).removeClass("showing-applied-filters"),result.html&&(append&&loading_previous?(jQuery(results).prepend(result.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):append?(jQuery(results).append(result.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):jQuery(results).html(result.html)),1==target.data("show_pagination")?(target.find(".food-manager-pagination").remove(),result.pagination&&target.append(result.pagination)):(!result.found_foods||result.max_num_pages<=page?jQuery(".load_more_foods:not(.load_previous)",target).hide():loading_previous||jQuery(".load_more_foods",target).show(),jQuery(".load_more_foods",target).removeClass("wpfm-loading"),jQuery("li.food_listing",results).css("visibility","visible")),jQuery(results).removeClass("wpfm-loading"),target.triggerHandler("updated_results",result)}catch(err){window.console&&WPFMCommon.logError(err)}},error:function(jqXHR,textStatus,error){window.console&&"abort"!==textStatus&&WPFMCommon.logError(textStatus+": "+error)},statusCode:{404:function(){window.console&&WPFMCommon.logError("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}}),event.preventDefault()}}}}};WPFMFoodAjaxFilters=WPFMFoodAjaxFilters(),jQuery(document).ready((function($){WPFMFoodAjaxFilters.init()}));