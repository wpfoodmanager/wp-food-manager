var WPFM_FoodAjaxFilters=function(){var o,e=[];return{init:function(){WPFM_Common.logInfo("WPFM_FoodAjaxFilters.init..."),jQuery.isFunction(jQuery.fn.chosen)&&(1==wpfm_ajax_filters.is_rtl&&(jQuery('select[name^="search_categories"]').addClass("chosen-rtl"),jQuery('select[name^="search_food_types"]').addClass("chosen-rtl")),jQuery('select[name^="search_categories"]').chosen({search_contains:!0}),jQuery('select[name^="search_food_types"]').chosen({search_contains:!0})),o=!(!window.history||!window.history.pushState),jQuery(document).ready(WPFM_FoodAjaxFilters.actions.windowLoad),jQuery(document.body).on("click",".load_more_foods",WPFM_FoodAjaxFilters.actions.loadMorefoods),jQuery(".food_filters").on("click",".reset",WPFM_FoodAjaxFilters.actions.WPFM_FoodAjaxFiltersReset),jQuery("div.food_listings").on("click",".food-manager-pagination a",WPFM_FoodAjaxFilters.actions.foodPagination),jQuery(".food_listings").on("update_food_listings",WPFM_FoodAjaxFilters.actions.getfoodListings),jQuery("#search_keywords, #search_categories, #search_food_menu, #search_food_types, .food-manager-filter").change(function(){var o=jQuery(this).closest("div.food_listings");o.triggerHandler("update_food_listings",[1,!1]),WPFM_FoodAjaxFilters.food_manager_store_state(o,1)}).on("keyup",function(o){13===o.which&&jQuery(this).trigger("change")})},food_manager_store_state:function(e,a){WPFM_Common.logInfo("WPFM_FoodAjaxFilters.food_manager_store_state...");var t=document.location.href.split("#")[0];if(o){var i=e.find(".food_filters"),r=jQuery(i).serialize(),s=jQuery("div.food_listings").index(e);window.history.replaceState({id:"food_manager_state",page:a,data:r,index:s},"",t)}},actions:{windowLoad:function(o){WPFM_Common.logInfo("WPFM_FoodAjaxFilters.actions.windowLoad..."),jQuery(".food_filters").each(function(){var o=jQuery(this).closest("div.food_listings");console.log(jQuery(this).closest("div.food_listings").length);var e=o.find(".food_filters"),a=1,t=jQuery("div.food_listings").index(o);if(window.history.state&&window.location.hash){var i=window.history.state;console.log(e.deserialize(i.data)),i.id&&"food_manager_state"===i.id&&t==i.index&&(a=1,e.deserialize(i.data),e.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"))}o.triggerHandler("update_food_listings",[a,!1])})},WPFM_FoodAjaxFiltersReset:function(o){WPFM_Common.logInfo("WPFM_FoodAjaxFilters.actions.WPFM_FoodAjaxFiltersReset...");var e=jQuery(this).closest("div.food_listings"),a=jQuery(this).closest("form");return a.find(':input[name="search_keywords"], .food-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find("#search_food_menu").not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_food_types"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),e.triggerHandler("reset"),e.triggerHandler("update_food_listings",[1,!1]),WPFM_FoodAjaxFilters.food_manager_store_state(e,1),!1},loadMorefoods:function(o){WPFM_Common.logInfo("WPFM_FoodAjaxFilters.actions.loadMorefoods...");var e=jQuery(this).closest("div.food_listings"),a=parseInt(jQuery(this).data("page")||1),t=!1;return jQuery(this).addClass("wpfm-loading"),a+=1,jQuery(this).data("page",a),e.triggerHandler("update_food_listings",[a,!0,t]),!1},foodPagination:function(o){WPFM_Common.logInfo("WPFM_FoodAjaxFilters.actions.foodPagination...");var e=jQuery(this).closest("div.food_listings"),a=jQuery(this).data("page");return WPFM_FoodAjaxFilters.food_manager_store_state(e,a),e.triggerHandler("update_food_listings",[a,!1]),jQuery("body, html").animate({scrollTop:e.offset().top},600),!1},getfoodListings:function(o,a,t,i){WPFM_Common.logInfo("WPFM_FoodAjaxFilters.actions.getfoodListings...");var r="",s=jQuery(this),n=s.find(".food_filters"),d=s.find(".showing_applied_filters"),l=s.find(".food_listings"),_=s.data("per_page"),f=s.data("orderby"),g=s.data("order"),u=s.data("featured"),c=s.data("cancelled"),p=jQuery("div.food_listings").index(this);if(!(p<0)){if(e[p]&&e[p].abort(),t||(jQuery(l).addClass("wpfm-loading"),jQuery("div.food_listing, div.no_food_listings_found",l).css("visibility","hidden"),s.find(".load_more_foods").data("page",a)),1==s.data("show_filters")){var h=n.find(':input[name^="search_categories"]').map(function(){return jQuery(this).val()}).get(),m=n.find(':input[name^="search_food_types"]').map(function(){return jQuery(this).val()}).get(),y=n.find("#search_food_menu").map(function(){return jQuery(this).val()}).get(),j="",F=n.find(':input[name="search_keywords"]');F.val()!==F.attr("placeholder")&&(j=F.val()),r={lang:wpfm_ajax_filters.lang,search_keywords:j,search_categories:h,search_food_types:m,search_food_menu:y,per_page:_,orderby:f,order:g,page:a,featured:u,cancelled:c,show_pagination:s.data("show_pagination"),form_data:n.serialize()}}else{j=s.data("keywords"),s.data("datetimes"),h=s.data("categories"),m=s.data("food_types"),y=s.data("search_food_menu");h&&(h=h.split(",")),r={lang:wpfm_ajax_filters.lang,search_keywords:j,search_categories:h,search_food_types:m,search_food_menu:y,per_page:_,orderby:f,order:g,page:a,featured:u,cancelled:c,show_pagination:s.data("show_pagination")}}e[p]=jQuery.ajax({type:"POST",url:wpfm_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:r,success:function(o){if(o)try{o.filter_value?jQuery(d).show().html("<span>"+o.filter_value+"</span>"+o.showing_links):jQuery(d).hide(),o.showing_applied_filters?jQuery(d).addClass("showing-applied-filters"):jQuery(d).removeClass("showing-applied-filters"),o.html&&(t&&i?(jQuery(l).prepend(o.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):t?(jQuery(l).append(o.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):jQuery(l).html(o.html)),1==s.data("show_pagination")?(s.find(".food-manager-pagination").remove(),o.pagination&&s.append(o.pagination)):(!o.found_foods||o.max_num_pages<=a?jQuery(".load_more_foods:not(.load_previous)",s).hide():i||jQuery(".load_more_foods",s).show(),jQuery(".load_more_foods",s).removeClass("wpfm-loading"),jQuery("li.food_listing",l).css("visibility","visible")),jQuery(l).removeClass("wpfm-loading"),s.triggerHandler("updated_results",o)}catch(o){window.console&&WPFM_Common.logError(o)}},error:function(o,e,a){window.console&&"abort"!==e&&WPFM_Common.logError(e+": "+a)},statusCode:{404:function(){window.console&&WPFM_Common.logError("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}}),o.preventDefault()}}}}};WPFM_FoodAjaxFilters=WPFM_FoodAjaxFilters(),jQuery(document).ready(function(o){WPFM_FoodAjaxFilters.init()});