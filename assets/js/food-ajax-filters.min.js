var WPFMFoodAjaxFilters=function(){var e,o=[];return{init:function(){WPFMCommon.logInfo("WPFMFoodAjaxFilters.init..."),jQuery.isFunction(jQuery.fn.chosen)&&(1==wpfm_ajax_filters.is_rtl&&(jQuery('select[name^="search_datetimes"]').addClass("chosen-rtl"),jQuery('select[name^="search_categories"]').addClass("chosen-rtl"),jQuery('select[name^="search_food_types"]').addClass("chosen-rtl"),jQuery('select[name^="search_ticket_prices"]').addClass("chosen-rtl")),jQuery('select[name^="search_datetimes"]').chosen({search_contains:!0}),jQuery('select[name^="search_categories"]').chosen({search_contains:!0}),jQuery('select[name^="search_food_types"]').chosen({search_contains:!0}),jQuery('select[name^="search_ticket_prices"]').chosen({search_contains:!0})),e=!!window.history&&!!window.history.pushState,jQuery(document).ready(WPFMFoodAjaxFilters.actions.windowLoad),jQuery(document.body).on("click",".load_more_foods",WPFMFoodAjaxFilters.actions.loadMorefoods),jQuery(".food_filters").on("click",".reset",WPFMFoodAjaxFilters.actions.WPFMFoodAjaxFiltersReset),jQuery("div.food_listings").on("click",".food-manager-pagination a",WPFMFoodAjaxFilters.actions.foodPagination),jQuery(".food_listings").on("update_food_listings",WPFMFoodAjaxFilters.actions.getfoodListings),jQuery("#search_keywords, #search_location, #search_datetimes, #search_categories, #search_food_types, #search_ticket_prices, .food-manager-filter").change(function(){var e=jQuery(this).closest("div.food_listings");e.triggerHandler("update_food_listings",[1,!1]),WPFMFoodAjaxFilters.food_manager_store_state(e,1)}).on("keyup",function(e){13===e.which&&jQuery(this).trigger("change")})},food_manager_store_state:function(o,t){WPFMCommon.logInfo("WPFMFoodAjaxFilters.food_manager_store_state...");var a=document.location.href.split("#")[0];if(e){var i=jQuery(o.find(".food_filters")).serialize(),s=jQuery("div.food_listings").index(o);window.history.replaceState({id:"food_manager_state",page:t,data:i,index:s},"",a)}},actions:{windowLoad:function(e){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.windowLoad..."),jQuery(".food_filters").each(function(){var e=jQuery(this).closest("div.food_listings");console.log(jQuery(this).closest("div.food_listings").length);var o=e.find(".food_filters"),t=1,a=jQuery("div.food_listings").index(e);if(window.history.state&&window.location.hash){var i=window.history.state;console.log(o.deserialize(i.data)),i.id&&"food_manager_state"===i.id&&a==i.index&&(t=1,o.deserialize(i.data),o.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').trigger("chosen:updated"),o.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"),o.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').trigger("chosen:updated"),o.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').trigger("chosen:updated"))}e.triggerHandler("update_food_listings",[t,!1])})},WPFMFoodAjaxFiltersReset:function(e){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.WPFMFoodAjaxFiltersReset...");var o=jQuery(this).closest("div.food_listings"),t=jQuery(this).closest("form");return t.find(':input[name="search_keywords"], :input[name="search_location"], .food-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),t.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),t.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),t.find(':input[name^="search_food_types"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),t.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),o.triggerHandler("reset"),o.triggerHandler("update_food_listings",[1,!1]),WPFMFoodAjaxFilters.food_manager_store_state(o,1),!1},loadMorefoods:function(e){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.loadMorefoods...");var o=jQuery(this).closest("div.food_listings"),t=parseInt(jQuery(this).data("page")||1);return jQuery(this).addClass("wpfm-loading"),t+=1,jQuery(this).data("page",t),o.triggerHandler("update_food_listings",[t,!0,!1]),!1},foodPagination:function(e){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.foodPagination...");var o=jQuery(this).closest("div.food_listings"),t=jQuery(this).data("page");return WPFMFoodAjaxFilters.food_manager_store_state(o,t),o.triggerHandler("update_food_listings",[t,!1]),jQuery("body, html").animate({scrollTop:o.offset().top},600),!1},getfoodListings:function(e,t,a,i){WPFMCommon.logInfo("WPFMFoodAjaxFilters.actions.getfoodListings...");var s="",n=jQuery(this),d=n.find(".food_filters"),r=n.find(".showing_applied_filters"),l=n.find(".food_listings"),c=n.data("per_page"),g=n.data("orderby"),f=n.data("order"),p=n.data("featured"),h=n.data("cancelled"),m=jQuery("div.food_listings").index(this);if(!(m<0)){if(o[m]&&o[m].abort(),a||(jQuery(l).addClass("wpfm-loading"),jQuery("div.food_listing, div.no_food_listings_found",l).css("visibility","hidden"),n.find(".load_more_foods").data("page",t)),!0==n.data("show_filters")){var u=d.find(':input[name^="search_datetimes"]').map(function(){return jQuery(this).val()}).get(),F=d.find(':input[name^="search_categories"]').map(function(){return jQuery(this).val()}).get(),v=d.find(':input[name^="search_food_types"]').map(function(){return jQuery(this).val()}).get(),y=d.find(':input[name^="search_ticket_prices"]').map(function(){return jQuery(this).val()}).get(),x="",w="",P=d.find(':input[name="search_keywords"]'),j=d.find(':input[name="search_location"]');P.val()!==P.attr("placeholder")&&(x=P.val()),j.val()!==j.attr("placeholder")&&(w=j.val()),s={lang:wpfm_ajax_filters.lang,search_keywords:x,search_location:w,search_datetimes:u,search_categories:F,search_food_types:v,search_ticket_prices:y,per_page:c,orderby:g,order:f,page:t,featured:p,cancelled:h,show_pagination:n.data("show_pagination"),form_data:d.serialize()}}else{var x=n.data("keywords"),w=n.data("location"),u=n.data("datetimes"),F=n.data("categories"),v=n.data("food_types"),y=n.data("ticket_prices");F&&(F=F.split(",")),s={lang:wpfm_ajax_filters.lang,search_keywords:x,search_location:w,search_datetimes:u,search_categories:F,search_food_types:v,search_ticket_prices:y,per_page:c,orderby:g,order:f,page:t,featured:p,cancelled:h,show_pagination:n.data("show_pagination")}}o[m]=jQuery.ajax({type:"POST",url:wpfm_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:s,success:function(e){if(e)try{e.filter_value?jQuery(r).show().html("<span>"+e.filter_value+"</span>"+e.showing_links):jQuery(r).hide(),e.showing_applied_filters?jQuery(r).addClass("showing-applied-filters"):jQuery(r).removeClass("showing-applied-filters"),e.html&&(a&&i?(jQuery(l).prepend(e.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):a?(jQuery(l).append(e.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):jQuery(l).html(e.html)),!0==n.data("show_pagination")?(n.find(".food-manager-pagination").remove(),e.pagination&&n.append(e.pagination)):(!e.found_foods||e.max_num_pages<=t?jQuery(".load_more_foods:not(.load_previous)",n).hide():i||jQuery(".load_more_foods",n).show(),jQuery(".load_more_foods",n).removeClass("wpfm-loading"),jQuery("li.food_listing",l).css("visibility","visible")),jQuery(l).removeClass("wpfm-loading"),n.triggerHandler("updated_results",e)}catch(o){window.console&&WPFMCommon.logError(o)}},error:function(e,o,t){window.console&&"abort"!==o&&WPFMCommon.logError(o+": "+t)},statusCode:{404:function(){window.console&&WPFMCommon.logError("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}}),e.preventDefault()}}}}};WPFMFoodAjaxFilters=WPFMFoodAjaxFilters(),jQuery(document).ready(function(e){WPFMFoodAjaxFilters.init()});