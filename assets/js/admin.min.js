var WPFMAdmin=function(){var file_frame,file_target_input,file_target_wrapper;return{init:function(){jQuery("div.food tr.wpfm-admin-common td.field-type select option").each((function(){"term-checklist"!=jQuery(this).val()&&"term-multiselect"!=jQuery(this).val()&&"term-select"!=jQuery(this).val()||jQuery(this).remove()})),jQuery(".tips, .help_tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),jQuery("body").on("click",".food-manager-remove-uploaded-file",(function(){return jQuery(this).closest(".food-manager-uploaded-file").remove()})),jQuery('input[data-picker="datepicker"]').length>0&&(wpfm_admin.show_past_date?jQuery('input[data-picker="datepicker"]').datepicker({dateFormat:wpfm_admin.i18n_datepicker_format,firstDay:wpfm_admin.start_of_week}):jQuery('input[data-picker="datepicker"]').datepicker({minDate:0,dateFormat:wpfm_admin.i18n_datepicker_format,firstDay:wpfm_admin.start_of_week})),jQuery(".wpfm-tabs li a").on("click",WPFMAdmin.actions.tabClick),jQuery(".wpfm-tabs li a:first").click(),jQuery(document).on("change",".wpfm-admin-menu-selection select.food-manager-category-dropdown",WPFMAdmin.actions.updateFoodinMenu),jQuery("body").on("click","a.wpfm-food-item-remove",WPFMAdmin.actions.removeFoodItem),jQuery(".wpfm-admin-food-menu-items ul.wpfm-food-menu").sortable(),jQuery("body").on("click",".wp_food_manager_upload_file_button_multiple",WPFMAdmin.fileUpload.multipleFile),jQuery("body").on("click",".wp_food_manager_upload_file_button",WPFMAdmin.fileUpload.addFile),jQuery(".wp_food_manager_add_another_file_button").on("click",WPFMAdmin.fileUpload.addAnotherFile),jQuery("#wpfm-add-new-option").on("click",WPFMAdmin.actions.addNewOption),jQuery(document).on("click",".wpfm-togglediv",(function(e){var row_count=jQuery(this).data("row-count"),menuItem;"true"===jQuery(e.currentTarget).attr("aria-expanded")?(jQuery(".wpfm-options-wrap.wpfm-options-box-"+row_count).removeClass("closed"),jQuery(this).attr("aria-expanded","false")):(jQuery(".wpfm-options-wrap.wpfm-options-box-"+row_count).addClass("closed"),jQuery(this).attr("aria-expanded","true")),jQuery(this).parents(".postbox").find(".wpfm-options-box-"+row_count+" .wpfm-metabox-content").slideToggle("slow")})),jQuery("body").on("wpfm_add_error_tip",(function(e,element,error_type){var offset=element.position();0===element.parent().find(".wpfm_error_tip").length&&(element.after('<div class="wpfm_error_tip '+error_type+'">'+wpfm_accounting_params[error_type]+"</div>"),element.parent().find(".wpfm_error_tip").css("left",offset.left+element.width()-element.width()/2-jQuery(".wpfm_error_tip").width()/2).css("top",offset.top+element.height()).fadeIn("100"))})),jQuery("body").on("wpfm_remove_error_tip",(function(e,element,error_type){element.parent().find(".wpfm_error_tip."+error_type).fadeOut("100",(function(){jQuery(this).remove()}))})),jQuery("body").on("click",(function(){jQuery(".wpfm_error_tip").fadeOut("100",(function(){jQuery(this).remove()}))})),jQuery("body").on("blur","#_food_sale_price",(function(){jQuery(".wpfm_error_tip").fadeOut("100",(function(){jQuery(this).remove()}))})),jQuery("body").on("keyup","#_food_sale_price",(function(s,l){var sale_price_field=jQuery(this),regular_price_field,sale_price,regular_price;regular_price_field=jQuery("#_food_price"),parseFloat(window.accounting.unformat(sale_price_field.val()))>=parseFloat(window.accounting.unformat(regular_price_field.val()))?jQuery(document.body).triggerHandler("wpfm_add_error_tip",[jQuery(this),"wpfm_sale_less_than_regular_error"]):jQuery(document.body).triggerHandler("wpfm_remove_error_tip",[jQuery(this),"wpfm_sale_less_than_regular_error"])})),jQuery("body").on("change","#_food_sale_price",(function(){var sale_price_field=jQuery(this),regular_price_field,sale_price,regular_price;regular_price_field=jQuery("#_food_price"),parseFloat(window.accounting.unformat(sale_price_field.val()))>=parseFloat(window.accounting.unformat(regular_price_field.val()))&&jQuery(this).val("")})),jQuery("body").on("keyup","#wpfm_icon_search",(function(){jQuery(this).next().show();var t=jQuery(this),i=t.parents("div.inside").find(".wpfm-font-awesome-class .sub-font-icon, .wpfm-food-font-icon-class .sub-font-icon"),a=new RegExp(t.val(),"gi");a?i.each((function(){var t=jQuery(this);t.find("label").text().match(a)?t.show():t.hide()})):item.show(),null===i.find("label").text().match(a)?jQuery(".no-radio-icons").show():jQuery(".no-radio-icons").hide()})),jQuery("body").on("click","span.wpfm-searh-clear",(function(){jQuery(this).prev().val(""),jQuery(this).hide(),jQuery("div.inside").find(".wpfm-font-awesome-class .sub-font-icon").show(),jQuery("div.inside").find(".wpfm-food-font-icon-class .sub-font-icon").show(),jQuery(".no-radio-icons").hide()})),jQuery("body").on("keyup",".wpfm-item-search input[type=text]",(function(){var t=jQuery(this),i=t.parents("ul.wpfm-available-list").find("li.available-item"),a=new RegExp(t.val(),"gi");a?i.each((function(){var t=jQuery(this);t.find("label").text().match(a)?t.show():t.hide()})):item.show()})),jQuery("#wpfm-ingredient-container .wpfm-sortable-list").sortable({connectWith:".wpfm-sortable-list",update:function(t,i){var a=jQuery(this),n=jQuery(i.item);if(console.log(this),a.hasClass("wpfm-active-list")){if(n.find("input").length<1){var r=n.data("id"),o=wpfm_var.units,l="";o&&jQuery.map(o,(function(e,t){l=l+"<option value='"+t+"'>"+e+"</option>"}));var s="<input type='number' name='_ingredient["+r+"][value]'><select name='_ingredient["+r+"][unit_id]'><option value=''>Unit</option>"+l+"</select>";n.find(".wpfm-sortable-item-values").html(s),n.removeClass("available-item").addClass("active-item")}}else n.find(".wpfm-sortable-item-values").html(""),n.removeClass("active-item").addClass("available-item")}}).disableSelection(),jQuery(".post-type-food_manager table.posts #the-list").length&&jQuery(".post-type-food_manager table.posts #the-list").sortable({items:"tr",axis:"y",helper:function(t,i){return i.children().children().each((function(){jQuery(this).width(jQuery(this).width())})),i},placeholder:"placeholder",opacity:.65,update:function(t,i){var a=jQuery("#the-list").sortable("serialize");jQuery.ajax({type:"POST",url:ajaxurl,data:a+"&action=wpfm-logo-update-menu-order",beforeSend:function(){jQuery("body").append(jQuery("<div id='wpfm-loading'><span class='wpfm-loading'>Updating ...</span></div>"))},success:function(response){jQuery("#wpfm-loading").remove()}})}}),jQuery(".post-type-food_manager .wpfm-admin-options-table table.widefat tbody").sortable({connectWith:".post-type-food_manager .wpfm-admin-options-table table.widefat tbody",items:"tr",axis:"y",helper:function(t,i){return i.children().children().each((function(){jQuery(this).width(jQuery(this).width())})),i},placeholder:"placeholder",opacity:.65,update:function(event,ui){var repeater_row_count=jQuery(this).closest(".postbox").children(".repeated-options").val();jQuery(".post-type-food_manager .wpfm-admin-options-table._option_options_"+repeater_row_count+" table.widefat tbody tr").each((function(i){var humanNum=i+1;jQuery(this).children("td:nth-child(2)").html(humanNum),jQuery(this).attr("class","option-tr-"+humanNum),jQuery(this).children(".option-value-class").val(humanNum),jQuery(this).children("td").children(".opt_name").attr("name",repeater_row_count+"_option_value_name_"+humanNum),jQuery(this).children("td").children(".opt_default").attr("name",repeater_row_count+"_option_value_default_"+humanNum),jQuery(this).children("td").children(".opt_price").attr("name",repeater_row_count+"_option_value_price_"+humanNum),jQuery(this).children("td").children(".opt_select").attr("name",repeater_row_count+"_option_value_price_type_"+humanNum),jQuery(this).children("td").children(".option-delete-btn").attr("data-id",humanNum)}))}}).disableSelection(),jQuery("#wpfm-nutrition-container .wpfm-sortable-list").sortable({connectWith:".wpfm-sortable-list",update:function(t,i){var a=jQuery(this),n=jQuery(i.item);if(a.hasClass("wpfm-active-list")){if(n.find("input").length<1){var r=n.data("id"),o=wpfm_var.units,l="";o&&jQuery.map(o,(function(e,t){l=l+"<option value='"+t+"'>"+e+"</option>"}));var s="<input type='number' name='_nutrition["+r+"][value]'><select name='_nutrition["+r+"][unit_id]'><option value=''>Unit</option>"+l+"</select>";n.find(".wpfm-sortable-item-values").html(s),n.removeClass("available-item").addClass("active-item")}}else n.find(".wpfm-sortable-item-values").html(""),n.removeClass("active-item").addClass("available-item")}}).disableSelection(),jQuery("body").on("change",'input[name^="option_name"]',WPFMAdmin.actions.updateOptionTitle),jQuery("body").on("change",'select[name^="_option_type"]',WPFMAdmin.actions.changeFieldType),jQuery(document).on("click",".wpfm-add-row",WPFMAdmin.actions.addElementRow),jQuery(document).on("click",".wpfm-delete-btn",WPFMAdmin.actions.removeAttributes),jQuery(document).on("click",".option-delete-btn",WPFMAdmin.actions.removeAttributesOptions)},actions:{tabClick:function(event){var option;return event.preventDefault(),jQuery(".wpfm_panel").hide(),jQuery(".nav-tab-active").removeClass("nav-tab-active"),jQuery(jQuery(this).attr("href")).show(),jQuery(this).addClass("nav-tab-active"),"days"==jQuery("#setting-event_manager_submission_expire_options:last option:selected").val()?jQuery("#setting-event_manager_submission_duration").closest("tr").show():jQuery("#setting-event_manager_submission_duration").closest("tr").hide(),!1},updateFoodinMenu:function(event){var category_id=jQuery(this).val(),taxonomy=jQuery(this).attr("data-taxonomy"),post_count=jQuery(this).find(":selected").attr("data-count"),exclude=[];if(0==post_count){var NoMenuItemText="food_manager_type"==taxonomy?"Selected food-type has no food.":"Selected category has no food.";return jQuery(".no-menu-item-handle").html(NoMenuItemText),jQuery(".no-menu-item-handle").show(),!1}jQuery("ul.wpfm-food-menu li").length>0&&jQuery("ul.wpfm-food-menu li").each((function(){exclude.push(jQuery(this).attr("data-food-id"))})),category_id.length>0?jQuery.ajax({type:"POST",url:wpfm_admin.ajax_url,data:{action:"wpfm_get_food_listings_by_category_id",category_id:category_id,taxonomy:taxonomy,exclude:exclude},success:function(response){0!==response.html.length?(jQuery("ul.wpfm-food-menu").append(response.html),jQuery(".no-menu-item-handle").hide()):jQuery("ul.wpfm-food-menu li").length<0&&jQuery(".no-menu-item-handle").show()},error:function(result){}}):jQuery.ajax({type:"POST",url:wpfm_admin.ajax_url,data:{action:"wpfm_get_food_listings_by_category_id",taxonomy:taxonomy,exclude:exclude},success:function(response){0!==response.html.length?(jQuery("ul.wpfm-food-menu").append(response.html),jQuery(".no-menu-item-handle").hide()):jQuery("ul.wpfm-food-menu li").length<0&&jQuery(".no-menu-item-handle").show()},error:function(result){}})},removeFoodItem:function(event){jQuery(this).parents("li").remove(),0==jQuery("ul.wpfm-food-menu li").length&&jQuery("#wpfm-admin-food-selection option").removeAttr("selected")},removeFoodSelectionVal:function(event){var selected_val;"options"==jQuery(this).val()&&(jQuery(".wp-food-manager-food-form-field-editor.extra_options td.field-type .field_type").find(".options").attr("disabled","disabled"),jQuery(this).find(".options").prop("disabled",!1))},addNewOption:function(event){var max_index=0;jQuery(".wpfm-options-wrapper").find("div.wpfm-options-wrap").length&&jQuery(".wpfm-options-wrapper").find("div.wpfm-options-wrap").each((function(){max_index++})),max_index+=1;var html=jQuery(this).data("row").replace(/%%repeated-option-index%%/g,max_index);jQuery("#extra_options_food_data_content .wpfm-options-wrapper .wpfm-actions").before(html),jQuery(".post-type-food_manager .wpfm-admin-options-table table.widefat tbody").sortable({connectWith:".post-type-food_manager .wpfm-admin-options-table table.widefat tbody",items:"tr",axis:"y",helper:function(t,i){return i.children().children().each((function(){jQuery(this).width(jQuery(this).width())})),i},placeholder:"placeholder",opacity:.65,update:function(event,ui){var repeater_row_count=jQuery(this).closest(".postbox").children(".repeated-options").val();jQuery(".post-type-food_manager .wpfm-admin-options-table._option_options_"+repeater_row_count+" table.widefat tbody tr").each((function(i){var humanNum=i+1;jQuery(this).children("td:nth-child(2)").html(humanNum),jQuery(this).attr("class","option-tr-"+humanNum),jQuery(this).children(".option-value-class").val(humanNum),jQuery(this).children("td").children(".opt_name").attr("name",repeater_row_count+"_option_value_name_"+humanNum),jQuery(this).children("td").children(".opt_default").attr("name",repeater_row_count+"_option_value_default_"+humanNum),jQuery(this).children("td").children(".opt_price").attr("name",repeater_row_count+"_option_value_price_"+humanNum),jQuery(this).children("td").children(".opt_select").attr("name",repeater_row_count+"_option_value_price_type_"+humanNum),jQuery(this).children("td").children(".option-delete-btn").attr("data-id",humanNum)}))}}).disableSelection();var repeater_row_counts=jQuery(this).parents(".wpfm-options-wrapper").children(".wpfm-options-wrap").length;fieldLabel=jQuery(this).parents(".wpfm-options-wrapper").find("p.wpfm-admin-postbox-form-field.wp-editor-field").attr("data-field-name");var fieldChangedLabel,editorId=fieldLabel.replace(fieldLabel.match(/(\d+)/g)[0],"")+repeater_row_counts;wp.editor.initialize(editorId,{tinymce:{wpautop:!1,textarea_rows:8,plugins:"lists,paste,tabfocus,wplink,wordpress",toolbar1:"bold,italic,|,bullist,numlist,|,link,unlink,|,undo,redo",toolbar2:""},quicktags:{buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close"},mediaButtons:!1})},updateOptionTitle:function(event){jQuery(this).closest(".postbox").children("h3").children(".attribute_name").text(this.value);var option_key=this.value.replace(/\s/g,"_").toLowerCase();jQuery(this).closest(".postbox").children("h3").children(".attribute_key").children("input").val(option_key),""==this.value&&(jQuery(this).closest(".postbox").children("h3").children(".attribute_name").text("Option Key"),jQuery(this).closest(".postbox").children("h3").children(".attribute_key").children("input").val("option_key"))},changeFieldType:function(event){var field_type=this.value,row_count=jQuery(this).closest(".postbox").children(".repeated-options").val();-1!==jQuery.inArray(field_type,["checkbox","select","radio"])?(jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-options-table").show(),jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-postbox-form-field._option_price_type_"+row_count).hide(),jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-postbox-form-field._option_price_"+row_count).hide()):(jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-options-table").hide(),jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-postbox-form-field._option_price_type_"+row_count).show(),jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-postbox-form-field._option_price_"+row_count).show())},addElementRow:function(event){var total_rows=0;total_rows=jQuery(this).parents("table").find("tbody tr").length,total_rows+=1;var row_count2=jQuery(this).closest(".postbox").children(".repeated-options").val(),html=jQuery(this).data("row").replace(/%%repeated-option-index3%%/g,total_rows).replace(/%%repeated-option-index2%%/g,row_count2);html.replace('value="1"',total_rows),jQuery(this).parents("table").find("tbody").append(html)},addAttributesFields:function(event){var attributes_box=jQuery(this).parents(".wpfm-attributes-box"),field_index=0;attributes_box&&jQuery(attributes_box).find(".wpfm-content").each((function(){field_index++})),field_index+=1;var wpfm_content=jQuery(attributes_box).find(".wpfm-content:first").html();jQuery(this).parents(".wpfm-metabox-footer").before('<div class="wpfm-content" data-field="'+field_index+'">'+wpfm_content+"</div>")},removeAttributes:function(event){jQuery(".wpfm-options-box-"+jQuery(this).data("id")).remove()},removeAttributesOptions:function(event){var row_count3=jQuery(this).closest(".postbox").children(".repeated-options").val();jQuery(".wpfm-options-box-"+row_count3+" div.wpfm-admin-options-table table tbody tr.option-tr-"+jQuery(this).data("id")).remove()},removeAttributesFields:function(){var field_content=jQuery(this).data("id");jQuery(field_content).remove()},saveAttributes:function(){jQuery('input[name="repeated-attribute-row[]"]').each((function(index,attribute){var attr_val=jQuery(attribute).val(),attr_label=jQuery(index).closest('input[name="repeated_attribute_lable"]').val();console.log(attr_label)})),jQuery.ajax({type:"POST",url:wpfm_admin.ajax_url,data:{action:"wpfm_update_food_attributes",security:wpfm_admin.security},success:function(response){},error:function(result){}})}},fileUpload:{addFile:function(event){event.preventDefault(),file_target_wrapper=jQuery(this).closest(".food-manager-uploaded-file"),file_target_input=file_target_wrapper.find("input");var data_field_name=jQuery(this).parents(".wpfm-admin-postbox-form-field")[0].dataset.fieldName,image_types=["jpg","gif","png","jpeg","jpe"];file_target_wrapper_append=jQuery(this).closest(".food-manager-uploaded-file2"),file_frame?file_frame.open():((file_frame=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!1})).on("select",(function(){attachment=file_frame.state().get("selection").first().toJSON(),jQuery(file_target_input).val(attachment.url),jQuery(file_target_wrapper_append).find(".food-manager-uploaded-file").remove(),jQuery.inArray(attachment.subtype,image_types)>=0?jQuery(file_target_wrapper_append).prepend("<span class='food-manager-uploaded-file'><input type='hidden' name='"+data_field_name+"' id='"+data_field_name+"' placeholder='' value='"+attachment.url+"'><span class='food-manager-uploaded-file-preview'><img src='"+attachment.url+"'><a class='food-manager-remove-uploaded-file' href='javascript:void(0);'>[remove]</a></span>"):jQuery(file_target_wrapper_append).prepend("<span class='food-manager-uploaded-file'><input type='hidden' name='"+data_field_name+"' id='"+data_field_name+"' placeholder='' value='"+attachment.url+"'><span class='food-manager-uploaded-file-preview'><span class='wpfm-icon'><strong style='display: block; padding-top: 5px;'>"+attachment.filename+"</strong><a target='_blank' href='"+attachment.url+"'><i class='wpfm-icon-download3' style='margin-right: 3px;'></i>Download</a></span><a class='food-manager-remove-uploaded-file' href='javascript:void(0);'>[remove]</a></span></span>")})),file_frame.open())},multipleFile:function(event){event.preventDefault(),file_target_wrapper=jQuery(this).parent(".file_url").find(".food-manager-uploaded-file.multiple-file"),file_target_input=file_target_wrapper.find("input");var data_field_name=jQuery(this).parents(".wpfm-admin-postbox-form-field")[0].dataset.fieldName,image_types=["jpg","gif","png","jpeg","jpe"];file_target_wrapper_apeend=jQuery(this).prev(),file_frame?file_frame.open():((file_frame=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!0})).on("select",(function(){attachment=file_frame.state().get("selection").map((function(attachment){return attachment.toJSON(),attachment})),jQuery.each(attachment,(function(index,attach){jQuery(file_target_input).val(attach.attributes.url),jQuery.inArray(attach.attributes.subtype,image_types)>=0?jQuery(file_target_wrapper_apeend).append("<span class='food-manager-uploaded-file multiple-file'><input type='hidden' name='"+data_field_name+"[]' placeholder='' value='"+attach.attributes.url+"'><span class='food-manager-uploaded-file-preview'><img src='"+attach.attributes.url+"'><a class='food-manager-remove-uploaded-file' href='javascript:void(0);'>[remove]</a></span>"):jQuery(file_target_wrapper_apeend).append("<span class='food-manager-uploaded-file multiple-file'><input type='hidden' name='"+data_field_name+"[]' placeholder='' value='"+attach.attributes.url+"'><span class='food-manager-uploaded-file-preview'><span class='wpfm-icon'><strong style='display: block; padding-top: 5px;'>"+attach.attributes.filename+"</strong><a target='_blank' href='"+attach.attributes.url+"'><i class='wpfm-icon-download3' style='margin-right: 3px;'></i>Download</a></span><a class='food-manager-remove-uploaded-file' href='javascript:void(0);'>[remove]</a></span></span>")}))})),file_frame.open())},addAnotherFile:function(event){event.preventDefault();var wrapper=jQuery(this).closest(".form-field"),field_name=jQuery(this).data("field_name"),field_placeholder=jQuery(this).data("field_placeholder"),button_text=jQuery(this).data("uploader_button_text"),button=jQuery(this).data("uploader_button");jQuery(this).before('<span class="file_url"><input type="text" name="'+field_name+'[]" placeholder="'+field_placeholder+'" /><button class="button button-small wp_food_manager_upload_file_button" data-uploader_button_text="'+button_text+'">'+button+"</button></span>")}}}};WPFMAdmin=WPFMAdmin(),jQuery(document).ready((function($){WPFMAdmin.init()}));