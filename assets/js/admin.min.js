var WPFM_Admin=function(){var t,e,i;return{init:function(){jQuery("div.food tr.wpfm-admin-common td.field-type select option").each(function(){("term-checklist"==jQuery(this).val()||"term-multiselect"==jQuery(this).val()||"term-select"==jQuery(this).val())&&jQuery(this).remove()}),jQuery("body").on("click",".food-manager-remove-uploaded-file",function(){return jQuery(this).closest(".food-manager-uploaded-file").remove()}),jQuery('input[data-picker="datepicker"]').length>0&&(wpfm_admin.show_past_date?jQuery('input[data-picker="datepicker"]').datepicker({dateFormat:wpfm_admin.i18n_datepicker_format,firstDay:wpfm_admin.start_of_week}):jQuery('input[data-picker="datepicker"]').datepicker({minDate:0,dateFormat:wpfm_admin.i18n_datepicker_format,firstDay:wpfm_admin.start_of_week})),jQuery(".wpfm-options-wrapper div.wpfm-options-wrap p.wpfm-admin-postbox-form-field.wp-editor-field").length&&jQuery(".wpfm-options-wrapper div.wpfm-options-wrap p.wpfm-admin-postbox-form-field.wp-editor-field").each(function(){var t=jQuery(this).parents(".wpfm-options-wrapper").find("p.wpfm-admin-postbox-form-field.wp-editor-field").attr("data-field-name");wp.editor.initialize(t,{tinymce:{wpautop:!1,textarea_rows:8,plugins:"lists,paste,tabfocus,wplink,wordpress",toolbar1:"bold,italic,|,bullist,numlist,|,link,unlink,|,undo,redo",toolbar2:""},quicktags:{buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close"},mediaButtons:!1})}),jQuery(".wpfm-tabs li a").on("click",WPFM_Admin.actions.tabClick),jQuery(".wpfm-tabs li a:first").click(),jQuery(document).on("change",".wpfm-admin-menu-selection select.food-manager-category-dropdown",WPFM_Admin.actions.updateFoodinMenu),jQuery("body").on("click","a.wpfm-food-item-remove",WPFM_Admin.actions.removeFoodItem),jQuery(".wpfm-admin-food-menu-items ul.wpfm-food-menu").sortable(),jQuery("body").on("click",".wp_food_manager_upload_file_button_multiple",WPFM_Admin.fileUpload.multipleFile),jQuery("body").on("click",".wp_food_manager_upload_file_button",WPFM_Admin.fileUpload.addFile),jQuery(".wp_food_manager_add_another_file_button").on("click",WPFM_Admin.fileUpload.addAnotherFile),jQuery("#wpfm-add-new-option").on("click",WPFM_Admin.actions.addNewOption),jQuery(document).on("click",".wpfm-togglediv",function(t){var e=jQuery(this).data("row-count");"true"===jQuery(t.currentTarget).attr("aria-expanded")?(jQuery(".wpfm-options-wrap.wpfm-options-box-"+e).removeClass("closed"),jQuery(this).attr("aria-expanded","false")):(jQuery(".wpfm-options-wrap.wpfm-options-box-"+e).addClass("closed"),jQuery(this).attr("aria-expanded","true")),jQuery(this).parents(".postbox").find(".wpfm-options-box-"+e+" .wpfm-metabox-content").slideToggle("slow")}),jQuery("body").on("wpfm_add_error_tip",function(t,e,i){var o=e.position();0===e.parent().find(".wpfm_error_tip").length&&(e.after('<div class="wpfm_error_tip '+i+'">'+wpfm_accounting_params[i]+"</div>"),e.parent().find(".wpfm_error_tip").css("left",o.left+e.width()-e.width()/2-jQuery(".wpfm_error_tip").width()/2).css("top",o.top+e.height()).fadeIn("100"))}),jQuery("body").on("wpfm_remove_error_tip",function(t,e,i){e.parent().find(".wpfm_error_tip."+i).fadeOut("100",function(){jQuery(this).remove()})}),jQuery("body").on("click",function(){jQuery(".wpfm_error_tip").fadeOut("100",function(){jQuery(this).remove()})}),jQuery("body").on("blur","#_food_sale_price",function(){jQuery(".wpfm_error_tip").fadeOut("100",function(){jQuery(this).remove()})}),jQuery("body").on("keyup","#_food_sale_price",function(t,e){var i,o=jQuery(this);i=jQuery("#_food_price");var a=parseFloat(window.accounting.unformat(o.val())),n=parseFloat(window.accounting.unformat(i.val()));a>=n?jQuery(document.body).triggerHandler("wpfm_add_error_tip",[jQuery(this),"wpfm_sale_less_than_regular_error"]):jQuery(document.body).triggerHandler("wpfm_remove_error_tip",[jQuery(this),"wpfm_sale_less_than_regular_error"])}),jQuery("body").on("change","#_food_sale_price",function(){var t,e=jQuery(this);t=jQuery("#_food_price");var i=parseFloat(window.accounting.unformat(e.val())),o=parseFloat(window.accounting.unformat(t.val()));i>=o&&jQuery(this).val("")}),jQuery("body").on("keyup","#wpfm_icon_search",function(){jQuery(this).next().show();var t=jQuery(this),e=t.parents("div.inside").find(".wpfm-food-icon-class .sub-font-icon"),i=RegExp(t.val(),"gi");i?e.each(function(){var t=jQuery(this);t.find("label").text().match(i)?t.show():t.hide()}):item.show(),null===e.find("label").text().match(i)?jQuery(".no-radio-icons").show():jQuery(".no-radio-icons").hide()}),jQuery("body").on("click","span.wpfm-searh-clear",function(){jQuery(this).prev().val(""),jQuery(this).hide(),jQuery("div.inside").find(".wpfm-food-icon-class .sub-font-icon").show(),jQuery(".no-radio-icons").hide()}),jQuery("body").on("keyup",".wpfm-item-search input[type=text]",function(){var t=jQuery(this),e=t.parents("ul.wpfm-available-list").find("li.available-item"),i=RegExp(t.val(),"gi");i?e.each(function(){var t=jQuery(this);t.find("label").text().match(i)?t.show():t.hide()}):item.show()}),jQuery("#wpfm-ingredient-container .wpfm-sortable-list").sortable({connectWith:".wpfm-sortable-list",update:function(t,e){var i=jQuery(this),o=jQuery(e.item);if(console.log(this),i.hasClass("wpfm-active-list")){if(o.find("input").length<1){var a=o.data("id"),n=wpfm_var.units,l="";n&&jQuery.map(n,function(t,e){l=l+"<option value='"+e+"'>"+t+"</option>"});var d="<input type='number' name='food_ingredients["+a+"][value]'><select name='food_ingredients["+a+"][unit_id]'><option value=''>Unit</option>"+l+"</select>";o.find(".wpfm-sortable-item-values").html(d),o.removeClass("available-item").addClass("active-item")}}else o.find(".wpfm-sortable-item-values").html(""),o.removeClass("active-item").addClass("available-item")}}).disableSelection(),jQuery(".post-type-food_manager table.posts #the-list").length&&jQuery(".post-type-food_manager table.posts #the-list").sortable({items:"tr",axis:"y",helper:function(t,e){return e.children().children().each(function(){jQuery(this).width(jQuery(this).width())}),e},placeholder:"placeholder",opacity:.65,update:function(t,e){var i=jQuery("#the-list").sortable("serialize");jQuery.ajax({type:"POST",url:ajaxurl,data:i+"&action=wpfm-logo-update-menu-order",beforeSend:function(){jQuery("body").append(jQuery("<div id='wpfm-loading'><span class='wpfm-loading'>Updating ...</span></div>"))},success:function(t){jQuery("#wpfm-loading").remove()}})}}),jQuery(".post-type-food_manager .wpfm-admin-options-table table.widefat tbody").sortable({connectWith:".post-type-food_manager .wpfm-admin-options-table table.widefat tbody",items:"tr",axis:"y",helper:function(t,e){return e.children().children().each(function(){jQuery(this).width(jQuery(this).width())}),e},placeholder:"placeholder",opacity:.65,update:function(t,e){var i=jQuery(this).closest(".postbox").children(".repeated-options").val();jQuery(".post-type-food_manager .wpfm-admin-options-table._topping_options_"+i+" table.widefat tbody tr").each(function(t){var e=t+1;jQuery(this).children("td:nth-child(2)").html(e),jQuery(this).attr("class","option-tr-"+e),jQuery(this).children(".option-value-class").val(e),jQuery(this).children("td").children(".opt_name").attr("name",i+"_option_name_"+e),jQuery(this).children("td").children(".opt_price").attr("name",i+"_option_price_"+e),jQuery(this).children("td").children(".option-delete-btn").attr("data-id",e)})}}).disableSelection(),jQuery("#wpfm-nutrition-container .wpfm-sortable-list").sortable({connectWith:".wpfm-sortable-list",update:function(t,e){var i=jQuery(this),o=jQuery(e.item);if(i.hasClass("wpfm-active-list")){if(o.find("input").length<1){var a=o.data("id"),n=wpfm_var.units,l="";n&&jQuery.map(n,function(t,e){l=l+"<option value='"+e+"'>"+t+"</option>"});var d="<input type='number' name='food_nutritions["+a+"][value]'><select name='food_nutritions["+a+"][unit_id]'><option value=''>Unit</option>"+l+"</select>";o.find(".wpfm-sortable-item-values").html(d),o.removeClass("available-item").addClass("active-item")}}else o.find(".wpfm-sortable-item-values").html(""),o.removeClass("active-item").addClass("available-item")}}).disableSelection(),jQuery("body").on("change",'input[name^="topping_name"]',WPFM_Admin.actions.updateOptionTitle),jQuery(document).on("click",".wpfm-add-row",WPFM_Admin.actions.addElementRow),jQuery(document).on("click",".wpfm-delete-btn",WPFM_Admin.actions.removeAttributes),jQuery(document).on("click",".option-delete-btn",WPFM_Admin.actions.removeAttributesOptions)},actions:{tabClick:function(t){return t.preventDefault(),jQuery(".wpfm_panel").hide(),jQuery(".nav-tab-active").removeClass("nav-tab-active"),jQuery(jQuery(this).attr("href")).show(),jQuery(this).addClass("nav-tab-active"),!1},updateFoodinMenu:function(t){var e=jQuery(this).val(),i=jQuery(this).attr("data-taxonomy"),o=jQuery(this).find(":selected").attr("data-count"),a=[];if(0==o)return jQuery(".no-menu-item-handle").html("food_manager_type"==i?"There is no food available in the selected food type.":"There is no food available in the selected category."),jQuery(".no-menu-item-handle").show(),!1;jQuery("ul.wpfm-food-menu li").length>0&&jQuery("ul.wpfm-food-menu li").each(function(){a.push(jQuery(this).attr("data-food-id"))}),e.length>0?jQuery.ajax({type:"POST",url:wpfm_admin.ajax_url,data:{action:"wpfm_get_food_listings_by_category_id",category_id:e,taxonomy:i,exclude:a},success:function(t){0!==t.html.length?(jQuery("ul.wpfm-food-menu").append(t.html),jQuery(".no-menu-item-handle").hide()):jQuery("ul.wpfm-food-menu li").length<0&&jQuery(".no-menu-item-handle").show()},error:function(t){}}):jQuery.ajax({type:"POST",url:wpfm_admin.ajax_url,data:{action:"wpfm_get_food_listings_by_category_id",taxonomy:i,exclude:a},success:function(t){0!==t.html.length?(jQuery("ul.wpfm-food-menu").append(t.html),jQuery(".no-menu-item-handle").hide()):jQuery("ul.wpfm-food-menu li").length<0&&jQuery(".no-menu-item-handle").show()},error:function(t){}})},removeFoodItem:function(t){jQuery(this).parents("li").remove(),console.log(jQuery("ul.wpfm-food-menu li").length),0==jQuery("ul.wpfm-food-menu li").length&&jQuery(".wpfm-admin-postbox-meta-data .food-manager-category-dropdown").val("")},removeFoodSelectionVal:function(t){"options"==jQuery(this).val()&&(jQuery(".wp-food-manager-food-form-field-editor.toppings td.field-type .field_type").find(".options").attr("disabled","disabled"),jQuery(this).find(".options").prop("disabled",!1))},addNewOption:function(t){var e=0;jQuery(".wpfm-options-wrapper").find("div.wpfm-options-wrap").length&&jQuery(".wpfm-options-wrapper").find("div.wpfm-options-wrap").each(function(){e++}),e+=1;var i=jQuery(this).data("row").replace(/%%repeated-option-index%%/g,e);jQuery("#toppings_food_data_content .wpfm-options-wrapper .wpfm-actions").before(i),jQuery(".post-type-food_manager .wpfm-admin-options-table table.widefat tbody").sortable({connectWith:".post-type-food_manager .wpfm-admin-options-table table.widefat tbody",items:"tr",axis:"y",helper:function(t,e){return e.children().children().each(function(){jQuery(this).width(jQuery(this).width())}),e},placeholder:"placeholder",opacity:.65,update:function(t,e){var i=jQuery(this).closest(".postbox").children(".repeated-options").val();jQuery(".post-type-food_manager .wpfm-admin-options-table._topping_options_"+i+" table.widefat tbody tr").each(function(t){var e=t+1;jQuery(this).children("td:nth-child(2)").html(e),jQuery(this).attr("class","option-tr-"+e),jQuery(this).children(".option-value-class").val(e),jQuery(this).children("td").children(".opt_name").attr("name",i+"_option_name_"+e),jQuery(this).children("td").children(".opt_price").attr("name",i+"_option_price_"+e),jQuery(this).children("td").children(".option-delete-btn").attr("data-id",e)})}}).disableSelection();var o=jQuery(this).parents(".wpfm-options-wrapper").children(".wpfm-options-wrap").length,a=(fieldLabel=jQuery(this).parents(".wpfm-options-wrapper").find("p.wpfm-admin-postbox-form-field.wp-editor-field").attr("data-field-name")).replace(fieldLabel.match(/(\d+)/g)[0],"");wp.editor.initialize(a+o,{tinymce:{wpautop:!1,textarea_rows:8,plugins:"lists,paste,tabfocus,wplink,wordpress",toolbar1:"bold,italic,|,bullist,numlist,|,link,unlink,|,undo,redo",toolbar2:""},quicktags:{buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close"},mediaButtons:!1})},updateOptionTitle:function(t){jQuery(this).closest(".postbox").children("h3").children(".attribute_name").text(this.value);var e=this.value.replace(/\s/g,"_").toLowerCase();jQuery(this).closest(".postbox").children("h3").children(".attribute_key").children("input").val(e),""==this.value&&(jQuery(this).closest(".postbox").children("h3").children(".attribute_name").text("Option Key"),jQuery(this).closest(".postbox").children("h3").children(".attribute_key").children("input").val("topping_key"))},changeFieldType:function(t){var e=this.value,i=jQuery(this).closest(".postbox").children(".repeated-options").val();-1!==jQuery.inArray(e,["checkbox","select","radio"])?(jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-options-table").show(),jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-postbox-form-field._option_price_"+i).hide()):(jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-options-table").hide(),jQuery(this).closest(".postbox").children(".wpfm-metabox-content").children(".wpfm-content").children(".wpfm-admin-postbox-form-field._option_price_"+i).show())},addElementRow:function(t){var e=0;e=jQuery(this).parents("table").find("tbody tr").length,e+=1;var i=jQuery(this).closest(".postbox").children(".repeated-options").val(),o=jQuery(this).data("row").replace(/%%repeated-option-index3%%/g,e).replace(/%%repeated-option-index2%%/g,i);o.replace('value="1"',e),jQuery(this).parents("table").find("tbody").append(o)},addAttributesFields:function(t){var e=jQuery(this).parents(".wpfm-attributes-box"),i=0;e&&jQuery(e).find(".wpfm-content").each(function(){i++}),i+=1;var o=jQuery(e).find(".wpfm-content:first").html();jQuery(this).parents(".wpfm-metabox-footer").before('<div class="wpfm-content" data-field="'+i+'">'+o+"</div>")},removeAttributes:function(t){jQuery(".wpfm-options-box-"+jQuery(this).data("id")).remove()},removeAttributesOptions:function(t){var e=jQuery(this).closest(".postbox").children(".repeated-options").val();jQuery(".wpfm-options-box-"+e+" tr.option-tr-"+jQuery(this).data("id")).remove()},removeAttributesFields:function(){var t=jQuery(this).data("id");jQuery(t).remove()}},fileUpload:{addFile:function(o){o.preventDefault(),e=(i=jQuery(this).closest(".food-manager-uploaded-file")).find("input");var a=jQuery(this).parents(".wpfm-admin-postbox-form-field")[0].dataset.fieldName,n=["jpg","gif","png","jpeg","jpe"];if(file_target_wrapper_append=jQuery(this).closest(".food-manager-uploaded-file2"),t){t.open();return}(t=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!1})).on("select",function(){attachment=t.state().get("selection").first().toJSON(),jQuery(e).val(attachment.url),jQuery(file_target_wrapper_append).find(".food-manager-uploaded-file").remove(),jQuery.inArray(attachment.subtype,n)>=0?jQuery(file_target_wrapper_append).prepend("<span class='food-manager-uploaded-file'><input type='hidden' name='"+a+"' id='"+a+"' placeholder='' value='"+attachment.url+"'><span class='food-manager-uploaded-file-preview'><img src='"+attachment.url+"'><a class='food-manager-remove-uploaded-file' href='javascript:void(0);'>[remove]</a></span>"):jQuery(file_target_wrapper_append).prepend("<span class='food-manager-uploaded-file'><input type='hidden' name='"+a+"' id='"+a+"' placeholder='' value='"+attachment.url+"'><span class='food-manager-uploaded-file-preview'><span class='wpfm-icon'><strong style='display: block; padding-top: 5px;'>"+attachment.filename+"</strong><a target='_blank' href='"+attachment.url+"'><i class='wpfm-icon-download3' style='margin-right: 3px;'></i>Download</a></span><a class='food-manager-remove-uploaded-file' href='javascript:void(0);'>[remove]</a></span></span>")}),t.open()},multipleFile:function(o){o.preventDefault(),e=(i=jQuery(this).parent(".file_url").find(".food-manager-uploaded-file.multiple-file")).find("input");var a=jQuery(this).parents(".wpfm-admin-postbox-form-field")[0].dataset.fieldName,n=["jpg","gif","png","jpeg","jpe"];if(file_target_wrapper_apeend=jQuery(this).prev(),t){t.open();return}(t=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!0})).on("select",function(){attachment=t.state().get("selection").map(function(t){return t.toJSON(),t}),jQuery.each(attachment,function(t,i){jQuery(e).val(i.attributes.url),jQuery.inArray(i.attributes.subtype,n)>=0?jQuery(file_target_wrapper_apeend).append("<span class='food-manager-uploaded-file multiple-file'><input type='hidden' name='"+a+"[]' placeholder='' value='"+i.attributes.url+"'><span class='food-manager-uploaded-file-preview'><img src='"+i.attributes.url+"'><a class='food-manager-remove-uploaded-file' href='javascript:void(0);'>[remove]</a></span>"):jQuery(file_target_wrapper_apeend).append("<span class='food-manager-uploaded-file multiple-file'><input type='hidden' name='"+a+"[]' placeholder='' value='"+i.attributes.url+"'><span class='food-manager-uploaded-file-preview'><span class='wpfm-icon'><strong style='display: block; padding-top: 5px;'>"+i.attributes.filename+"</strong><a target='_blank' href='"+i.attributes.url+"'><i class='wpfm-icon-download3' style='margin-right: 3px;'></i>Download</a></span><a class='food-manager-remove-uploaded-file' href='javascript:void(0);'>[remove]</a></span></span>")})}),t.open()},addAnotherFile:function(t){t.preventDefault(),jQuery(this).closest(".form-field");var e=jQuery(this).data("field_name"),i=jQuery(this).data("field_placeholder"),o=jQuery(this).data("uploader_button_text"),a=jQuery(this).data("uploader_button");jQuery(this).before('<span class="file_url"><input type="text" name="'+e+'[]" placeholder="'+i+'" /><button class="button button-small wp_food_manager_upload_file_button" data-uploader_button_text="'+o+'">'+a+"</button></span>")}}}};WPFM_Admin=WPFM_Admin(),jQuery(document).ready(function(t){WPFM_Admin.init()});